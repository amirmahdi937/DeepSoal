<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeepSoal - Ù¾Ø±Ø³Ø´ Ø±ÙˆØ²</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'core/style.css' %}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
</head>
<body>
    <div class="container">
        <!-- Ù‡Ø¯Ø± Ø²ÛŒØ¨Ø§ -->
        <header>
            <h1>DeepSoal</h1>
            <p class="tagline">Ù‡Ø± Ø±ÙˆØ² ÛŒÚ© Ù¾Ø±Ø³Ø´ Ø¬Ø¯ÛŒØ¯. Ø°Ù‡Ù†â€ŒØªØ§Ù† Ø±Ø§ Ø¨Ù‡ Ú†Ø§Ù„Ø´ Ø¨Ú©Ø´ÛŒØ¯.</p>
        </header>

        <main>
            <!-- Ù†ÙˆØ§Ø± Ø¢Ù…Ø§Ø± -->
            <section id="stats-container">
                <div style="text-align: center; padding: 20px; color: var(--gray);">
                    <div style="display: inline-block; animation: pulse 1.5s infinite;">â³</div>
                    <div>Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¢Ù…Ø§Ø±...</div>
                </div>
            </section>

            <!-- Ù†Ø§ÙˆØ¨Ø±ÛŒ Ø§ØµÙ„ÛŒ -->
            <nav id="navigation" class="auth-buttons" style="margin-bottom: 30px; justify-content: center;">
                <button onclick="showView('home')" class="btn">
                    ğŸ  ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ
                </button>
                <button onclick="showView('search')" class="btn btn-secondary">
                    ğŸ” Ø¬Ø³ØªØ¬Ùˆ
                </button>
                <button onclick="showView('all-answers')" class="btn btn-secondary">
                    ğŸ“š Ù‡Ù…Ù‡ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§
                </button>
            </nav>

            <!-- Ø¨Ø®Ø´ Ø§ØµÙ„ÛŒ - ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ -->
            <section id="home-view">
                <!-- Ø³ÙˆØ§Ù„ ÙØ¹Ø§Ù„ -->
                <section id="question-container">
                    <div style="text-align: center; padding: 40px; color: var(--gray);">
                        <div style="display: inline-block; animation: pulse 1.5s infinite;">â³</div>
                        <div>Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø³ÙˆØ§Ù„...</div>
                    </div>
                </section>

                <!-- ÙØ±Ù… Ø§Ø±Ø³Ø§Ù„ Ù¾Ø§Ø³Ø® -->
                <form id="answer-form" class="answer-form">
                    <h3 style="margin-bottom: 16px; color: var(--primary);">âœï¸ Ù¾Ø§Ø³Ø® Ø´Ù…Ø§</h3>
                    
                    <div class="form-group">
                        <label for="author-name">ğŸ“› Ù†Ø§Ù… Ø´Ù…Ø§ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)</label>
                        <input 
                            type="text" 
                            id="author-name" 
                            placeholder="Ù†Ø§Ù… Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ (Ø¯Ø± ØµÙˆØ±Øª Ø¹Ø¯Ù… ÙˆØ§Ø±Ø¯ Ú©Ø±Ø¯Ù†ØŒ 'Ù†Ø§Ø´Ù†Ø§Ø³' Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯)"
                        >
                    </div>
                    
                    <div class="form-group">
                        <label for="answer-text">ğŸ’­ Ù¾Ø§Ø³Ø® Ø´Ù…Ø§</label>
                        <textarea 
                            id="answer-text" 
                            placeholder="Ù†Ø¸Ø±Ø§Øª Ùˆ Ù¾Ø§Ø³Ø® Ø®ÙˆØ¯ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯..." 
                            required
                        ></textarea>
                    </div>
                    
                    <button type="submit" class="btn">
                        ğŸ“¤ Ø§Ø±Ø³Ø§Ù„ Ù¾Ø§Ø³Ø®
                    </button>
                </form>

                <!-- Ù„ÛŒØ³Øª Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ -->
                <section class="answers-list">
                    <h3 style="margin-bottom: 16px; color: var(--primary);">ğŸ’¬ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§</h3>
                    <div id="answers-container">
                        <div style="text-align: center; padding: 20px; color: var(--gray);">
                            <div style="display: inline-block; animation: pulse 1.5s infinite;">â³</div>
                            <div>Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§...</div>
                        </div>
                    </div>
                </section>
            </section>

            <!-- Ø¨Ø®Ø´ Ø¬Ø³ØªØ¬Ùˆ -->
            <section id="search-view" style="display: none;">
                <div class="search-panel">
                    <div class="search-header">
                        <h3 style="color: var(--primary); margin-bottom: 0;">ğŸ” Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§</h3>
                    </div>
                    
                    <div class="form-group">
                        <input 
                            type="text" 
                            id="search-input" 
                            placeholder="Ø¹Ø¨Ø§Ø±Øª Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø¨Ø±Ø§ÛŒ Ø¬Ø³ØªØ¬Ùˆ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯..."
                            style="margin-bottom: 0;"
                        >
                    </div>
                    
                    <button onclick="handleSearch()" class="btn" style="width: 100%; margin-top: 15px;">
                        ğŸ” Ø§Ø¬Ø±Ø§ÛŒ Ø¬Ø³ØªØ¬Ùˆ
                    </button>
                </div>

                <div id="search-results">
                    <div style="text-align: center; padding: 40px; color: var(--gray);">
                        <div>ğŸ” Ø¨Ø±Ø§ÛŒ Ø¯ÛŒØ¯Ù† Ù†ØªØ§ÛŒØ¬ Ø¬Ø³ØªØ¬ÙˆØŒ Ø¹Ø¨Ø§Ø±Øª Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.</div>
                    </div>
                </div>
            </section>

            <!-- Ø¨Ø®Ø´ Ù‡Ù…Ù‡ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ -->
            <section id="all-answers-view" style="display: none;">
                <div style="text-align: center; margin-bottom: 30px;">
                    <h3 style="color: var(--primary); margin-bottom: 10px;">ğŸ“š Ù‡Ù…Ù‡ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§</h3>
                    <p style="color: var(--gray);">Ù†Ù…Ø§ÛŒØ´ ØªÙ…Ø§Ù… Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ø«Ø¨Øª Ø´Ø¯Ù‡ Ø¯Ø± Ø³ÛŒØ³ØªÙ…</p>
                </div>

                <div id="all-answers-container">
                    <div style="text-align: center; padding: 40px; color: var(--gray);">
                        <div style="display: inline-block; animation: pulse 1.5s infinite;">â³</div>
                        <div>Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù‡Ù…Ù‡ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§...</div>
                    </div>
                </div>
            </section>
        </main>

        <!-- ÙÙˆØªØ± Ø²ÛŒØ¨Ø§ -->
        <footer class="footer">
            <div>Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯Ù‡ Ø¨Ø§ â¤ï¸</div>
            <div class="creator">Ø§Ù…ÛŒØ±Ù…Ù‡Ø¯ÛŒ Ø¹Ø²ÛŒØ²ÛŒ</div>
            <div style="margin-top: 8px; font-size: 0.75rem; opacity: 0.7;">
                DeepSoal - Ù¾Ù„ØªÙØ±Ù… Ù¾Ø±Ø³Ø´ Ùˆ Ù¾Ø§Ø³Ø® Ø±ÙˆØ²Ø§Ù†Ù‡
            </div>
        </footer>
    </div>

    <script src="{% static 'core/script.js' %}"></script>

    <script>
        // ØªÙˆØ§Ø¨Ø¹ Ù…Ø¯ÛŒØ±ÛŒØª Ù†Ø§ÙˆØ¨Ø±ÛŒ
        function showView(viewName) {
            // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡ Ø¨Ø®Ø´â€ŒÙ‡Ø§
            const sections = ['home', 'search', 'all-answers'];
            sections.forEach(section => {
                const element = document.getElementById(`${section}-view`);
                if (element) element.style.display = 'none';
            });
            
            // Ù†Ù…Ø§ÛŒØ´ Ø¨Ø®Ø´ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
            const currentSection = document.getElementById(`${viewName}-view`);
            if (currentSection) currentSection.style.display = 'block';
            
            // Ø¢Ù¾Ø¯ÛŒØª Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù†Ø§ÙˆØ¨Ø±ÛŒ
            updateNavigation(viewName);
            
            // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø­ØªÙˆØ§ÛŒ Ø®Ø§Øµ Ù‡Ø± Ø¨Ø®Ø´
            if (viewName === 'all-answers') {
                loadAllAnswers();
            }
        }

        function updateNavigation(currentView) {
            const buttons = document.querySelectorAll('#navigation button');
            buttons.forEach(btn => {
                if (btn.textContent.includes('ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ') && currentView === 'home') {
                    btn.className = 'btn';
                } else if (btn.textContent.includes('Ø¬Ø³ØªØ¬Ùˆ') && currentView === 'search') {
                    btn.className = 'btn';
                } else if (btn.textContent.includes('Ù‡Ù…Ù‡ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§') && currentView === 'all-answers') {
                    btn.className = 'btn';
                } else {
                    btn.className = 'btn btn-secondary';
                }
            });
        }

        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù‡Ù…Ù‡ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§
        async function loadAllAnswers() {
            const container = document.getElementById('all-answers-container');
            if (!container) return;

            try {
                container.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: var(--gray);">
                        <div style="display: inline-block; animation: pulse 1.5s infinite;">â³</div>
                        <div>Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù‡Ù…Ù‡ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§...</div>
                    </div>
                `;

                const response = await fetch('https://deepsoal.onrender.com/api/all-answers/');
                
                if (response.ok) {
                    const answers = await response.json();
                    renderAllAnswers(answers, container);
                } else {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 20px; color: var(--error);">
                            <div>âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§</div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading all answers:', error);
                container.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: var(--error);">
                        <div>âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±</div>
                    </div>
                `;
            }
        }

        function renderAllAnswers(answers, container) {
            container.innerHTML = '';
            
            if (answers.length === 0) {
                container.innerHTML = `
                    <div class="answer-card">
                        <div class="answer-text" style="text-align: center; color: var(--gray);">
                            ğŸ“ Ù‡ÛŒÚ† Ù¾Ø§Ø³Ø®ÛŒ Ø¯Ø± Ø³ÛŒØ³ØªÙ… Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.
                        </div>
                    </div>
                `;
                return;
            }

            // Ú¯Ø±ÙˆÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø³ÙˆØ§Ù„
            const answersByQuestion = {};
            answers.forEach(answer => {
                const questionId = answer.question.id;
                if (!answersByQuestion[questionId]) {
                    answersByQuestion[questionId] = {
                        question: answer.question,
                        answers: []
                    };
                }
                answersByQuestion[questionId].answers.push(answer);
            });

            // Ù†Ù…Ø§ÛŒØ´ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ Ú¯Ø±ÙˆÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø´Ø¯Ù‡
            Object.values(answersByQuestion).forEach(group => {
                const questionSection = document.createElement('div');
                questionSection.className = 'question-card';
                questionSection.style.marginBottom = '30px';
                
                questionSection.innerHTML = `
                    <div class="question-text" style="font-weight: 500; margin-bottom: 15px;">
                        ${escapeHtml(group.question.question_text)}
                    </div>
                    ${group.question.category ? `
                        <div class="badge" style="background: ${group.question.category.color}; margin-bottom: 15px;">
                            ${group.question.category.name}
                        </div>
                    ` : ''}
                    <div style="color: var(--gray); font-size: 0.9rem; margin-bottom: 15px;">
                        ğŸ“Š ${group.answers.length} Ù¾Ø§Ø³Ø®
                    </div>
                `;

                group.answers.forEach(answer => {
                    const answerElement = document.createElement('div');
                    answerElement.className = 'answer-card';
                    answerElement.style.marginBottom = '10px';
                    answerElement.innerHTML = `
                        <div class="answer-header">
                            <span class="answer-user">ğŸ‘¤ ${escapeHtml(answer.author_name)}</span>
                            <span class="answer-time">ğŸ•’ ${answer.time_since}</span>
                        </div>
                        <div class="answer-text">${escapeHtml(answer.answer_text)}</div>
                        <div class="answer-actions">
                            <button class="like-btn" onclick="likeAnswer(${answer.id})">
                                â¤ ${answer.likes}
                            </button>
                            <button class="share-btn" onclick="shareAnswer(${answer.id})">
                                ğŸ”— Ø§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ
                            </button>
                        </div>
                    `;
                    questionSection.appendChild(answerElement);
                });

                container.appendChild(questionSection);
            });
        }

        // ØªØ§Ø¨Ø¹ escapeHtml
        function escapeHtml(unsafe) {
            if (!unsafe) return '';
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        // Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
        document.addEventListener('DOMContentLoaded', function() {
            // ØªÙ†Ø¸ÛŒÙ… Ù†Ø§ÙˆØ¨Ø±ÛŒ
            updateNavigation('home');
        });

        // ØªÙˆØ§Ø¨Ø¹ global
        window.showView = showView;
        window.loadAllAnswers = loadAllAnswers;
    </script>
</body>
</html>
