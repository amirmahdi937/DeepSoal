<!DOCTYPE html>
<html>
<head>
    <title>DeepSoal</title>
    <style>
        body { font-family: Tahoma; max-width: 800px; margin: 0 auto; padding: 20px; }
        .question { background: #f0f0f0; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        .answer { border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 5px; }
        textarea { width: 100%; height: 100px; margin: 10px 0; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>DeepSoal - سوال روز</h1>
    
    <div id="question" class="question">
        در حال بارگذاری سوال...
    </div>

    <div>
        <h3>پاسخ شما:</h3>
        <input type="text" id="author" placeholder="نام شما (اختیاری)">
        <textarea id="answer-text" placeholder="پاسخ خود را بنویسید..."></textarea>
        <button onclick="submitAnswer()">ارسال پاسخ</button>
    </div>

    <div id="answers">
        <h3>پاسخ‌ها:</h3>
        در حال بارگذاری...
    </div>

    <script>
        async function loadQuestion() {
            const response = await fetch('/api/question/');
            const data = await response.json();
            document.getElementById('question').innerHTML = data.text || 'سوالی یافت نشد';
        }

        async function loadAnswers() {
            const response = await fetch('/api/answers/');
            const answers = await response.json();
            const container = document.getElementById('answers');
            container.innerHTML = '<h3>پاسخ‌ها:</h3>';
            
            answers.forEach(answer => {
                const div = document.createElement('div');
                div.className = 'answer';
                div.innerHTML = `
                    <strong>${answer.author}</strong> - ${answer.created_at}
                    <p>${answer.text}</p>
                    <button onclick="likeAnswer(${answer.id})">لایک (${answer.likes})</button>
                `;
                container.appendChild(div);
            });
        }

        async function submitAnswer() {
            const author = document.getElementById('author').value || 'ناشناس';
            const text = document.getElementById('answer-text').value;
            
            const formData = new FormData();
            formData.append('author', author);
            formData.append('text', text);
            
            await fetch('/api/answers/add/', {
                method: 'POST',
                body: formData
            });
            
            document.getElementById('answer-text').value = '';
            loadAnswers();
        }

        async function likeAnswer(answerId) {
            await fetch(`/api/answers/${answerId}/like/`);
            loadAnswers();
        }

        // شروع
        loadQuestion();
        loadAnswers();
        setInterval(loadAnswers, 5000); // آپدیت هر ۵ ثانیه
    </script>
</body>
</html>
